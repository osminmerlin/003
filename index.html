<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>轻打卡系统</title>
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#007aff">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <h1 id="app-title">轻打卡系统</h1>
    <button id="settings-btn" aria-label="设置">⚙️</button>
  </header>
  <main>
    <section id="checkin-section">
      <div id="checkin-details">
        <div id="checkin-name">目标：<span id="habit-name">吸烟</span></div>
        <button id="checkin-btn">打卡</button>
        <div id="checkin-feedback"></div>
      </div>
      <div id="stats">
        <span id="today-count">今日打卡次数：0</span>
        <span id="avg-interval">平均间隔：-- 分钟</span>
      </div>
      <div id="recent-records">
        <h3>最近5次打卡</h3>
        <ul id="record-list"></ul>
        <div id="no-record-tip" style="display:none;">暂无打卡记录</div>
      </div>
    </section>
    <section id="report-section">
      <button id="report-btn">查看数据报告</button>
    </section>
    <div id="ios-tip" style="display:none; background:#fffbe7; color:#c88c00; padding:12px; border-radius:10px; margin:15px; font-size:1.01rem;">
      ⚠️ 提示：iPhone锁屏或后台时，网页无法发送系统级提醒。建议将本页面“添加到主屏幕”并保持前台，或使用原生App实现强提醒。
    </div>
    <section style="margin:20px 0;">
      <button id="subscribe-push">允许后端推送</button>
      <button id="unsubscribe-push" style="display:none;">取消后端推送</button>
    </section>
  </main>
  <div id="floating-notice" style="display:none;"></div>
  <div class="modal" id="settings-modal">
    <div class="modal-content">
      <span class="close" id="close-settings">&times;</span>
      <h2>个性化设置</h2>
      <label>打卡名称 <input id="input-habit-name" maxlength="10"></label>
      <label>通知标题 
        <input id="input-notify-title" maxlength="20" readonly value="吸烟时间到了，快去吸烟。">
      </label>
      <label>提醒间隔 
        <input id="input-remind-interval" type="number" min="1" max="360" step="1"> 分钟
      </label>
      <button id="save-settings">保存设置</button>
    </div>
  </div>
  <div class="modal" id="report-modal">
    <div class="modal-content" style="max-width:400px;">
      <span class="close" id="close-report">&times;</span>
      <h2>数据可视化报告</h2>
      <div id="tab-btns">
        <button data-tab="day">每日</button>
        <button data-tab="month">每月</button>
        <button data-tab="year">每年</button>
      </div>
      <div id="report-charts">
        <canvas id="day-chart"></canvas>
        <canvas id="month-chart" style="display:none;"></canvas>
        <canvas id="year-chart" style="display:none;"></canvas>
      </div>
      <div id="report-stats"></div>
    </div>
  </div>
  <script src="main.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }
    function isiOS() {
      return /iPhone|iPad|iPod/i.test(navigator.userAgent);
    }
    window.onload = function() {
      if (isiOS()) document.getElementById('ios-tip').style.display = '';
    };
  </script>
</body>
</html>